<!DOCTYPE html>
<html>
<head>
<title>NFC.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
	font-size: 14px;
	padding: 0 12px;
	line-height: 22px;
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}


body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	color: #4080D0;
	text-decoration: none;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
	font-size: inherit;
	line-height: auto;
}

a:hover {
	color: #4080D0;
	text-decoration: underline;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left: 5px solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 14px;
	line-height: 19px;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

.mac code {
	font-size: 12px;
	line-height: 18px;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

/** Theming */

.vscode-light,
.vscode-light pre code {
	color: rgb(30, 30, 30);
}

.vscode-dark,
.vscode-dark pre code {
	color: #DDD;
}

.vscode-high-contrast,
.vscode-high-contrast pre code {
	color: white;
}

.vscode-light code {
	color: #A31515;
}

.vscode-dark code {
	color: #D7BA7D;
}

.vscode-light pre:not(.hljs),
.vscode-light code > div {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre:not(.hljs),
.vscode-dark code > div {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre:not(.hljs),
.vscode-high-contrast code > div {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

.vscode-light blockquote,
.vscode-dark blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.vscode-high-contrast blockquote {
	background: transparent;
	border-color: #fff;
}
</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family:  "Meiryo", "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

</head>
<body>
<h1 id="near-field-communication">Near Field Communication</h1>
<h2 id="%E4%B8%80-nfc%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD">一 NFC基本概念与相关术语</h2>
<ul>
<li>NFC是什么东东？</li>
</ul>
<blockquote>
<p>全称 Near Field Communication （近场通讯），这个技术由非接触式射频识别（RFID）演变而来，由飞利浦半导体（现恩智浦半导体公司）、诺基亚和索尼共同研制开发，其基础是RFID及互连技术。近场通信（Near Field Communication,NFC）是一种短距高频的无线电技术，在13.56MHz频率运行于10厘米距离内</p>
</blockquote>
<ul>
<li>NFC Tag</li>
</ul>
<blockquote>
<p>它是廉价的、被动式的RFID（射频识别）Tag,粘贴或内嵌如产品，包裹，促销品及许多其他实物，甚至像电影里一样嵌入皮肤。那么问题又来了RFID Tags 是什么？</p>
</blockquote>
<ul>
<li>RFID Tag</li>
</ul>
<blockquote>
<p>它由耦合元件及芯片组成，每个RFID标签具有唯一的电子编码（全球唯一哦😯），附着在物体上标识目标对象，俗称电子标签或智能标签。RFID电子标签：有源标签，无源标签，半有源半无源标签。普通用的地铁卡就是无源标签。 什么编码这么牛X, 全球唯一？是EPC编码</p>
</blockquote>
<ul>
<li>EPC编码</li>
</ul>
<blockquote>
<p>EPC（Electronic Product Code）即电子产品编码，是一种编码系统。它建立在EAN.UCC（即全球统一标识系统）条型编码的基础之上，并对该条形编码系统做了一些扩充，用以实现对单品进行标志。
它是下一代产品标识代码，它可以对供应链中的对象（包括物品、货箱、货盘、位置等）进行全球唯一的标识。EPC 存储在RFID标签上，这个标签包含一块硅芯片和一根天线。读取 EPC标签时，它可以与一些动态数据连接，例如该贸易项目的原产地或生产日期等。EPC所标识产品的信息保存在EPCglobal网络中，而EPC则是获取有关这些信息的一把钥匙</p>
</blockquote>
<ul>
<li>WWDC解释：</li>
</ul>
<blockquote>
<p>NFC实际上是一组不同的标准和协议。所有的标准共存，并用于不同的目的。
NFC text可归纳为5类，type1~type5.每一个类型对应于一个不同的标准。
NFC Forum定义了NFC Data Exchange Format(NDEF)用来作为不同的NFC text类型数据交换的通用标准方式
<img src="./5type.png" alt="NFC TEXT"></p>
</blockquote>
<h2 id="%E4%BA%8C-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">二 使用场景</h2>
<h3 id="nfc%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E6%9C%89%E4%B8%89%E7%A7%8D%EF%BC%9A">NFC工作模式有三种：</h3>
<ol>
<li>Reader/Writer mode（读写器模式）iOS只支持reader模式</li>
</ol>
<blockquote>
<p>此模式可以读取NFC Tag,也可写入Tag数据。（可以想象手机给地铁卡充值，它能读取卡内信息，也能写入数据），苹果给出的使用的场景1.连接用户到位置或上下文相关的内容2.连接硬件设备3.仓库库存追踪。</p>
</blockquote>
<ol start="2">
<li>Peer-to-Peer mode (点对点模式)  iOS 不支持</li>
</ol>
<blockquote>
<p>将两个具备NFC功能的设备链接，能实现数据点对点传输，如下载音乐、交换图片或者同步设备地址薄。</p>
</blockquote>
<ol start="3">
<li>Card-emulation mode （卡模拟模式）iOS不支持</li>
</ol>
<blockquote>
<p>可以将具备NFC功能的设备当做只能卡或者IC卡，比如地铁卡，信用卡，门禁卡。</p>
</blockquote>
<h3 id="nfc%E6%98%AF%E6%80%8E%E4%B9%88%E6%A3%80%E6%B5%8B%E5%88%B0tag%E7%9A%84%EF%BC%9F">NFC是怎么检测到Tag的？</h3>
<blockquote>
<p>在NFC Tag(它是一种廉价、被动式的RFID tag, 就是一个集成电路)中有天线与电路。当拿具备NFC功能的手机或其他读取器靠近时，手机或读取器发射高频电磁波（射频信号），引发Tag内的电路产生感应电流（卡内没有电源，全靠读取器发射的电磁波产生电流驱动），Tag利用产生的电流发射出Tag内存储是数据</p>
</blockquote>
<h2 id="%E4%B8%89-ios-%E5%AF%B9nfc%E6%94%AF%E6%8C%81%E7%9A%84%E7%8E%B0%E7%8A%B6">三 iOS 对NFC支持的现状</h2>
<p>2017年，WWDC正式发布了iOS11,在SDK中首次开放了NFC功能,开发者可通过Core NFC FrameWork 使用NFC功能。此次发布的版本支持的功能非常保守，只支持 NFC Tag Reading 功能</p>
<ul>
<li>支持机型：</li>
</ul>
<blockquote>
<p>iPhone 7 及后续发布机型（虽然iPhone 6开始已经有NFC硬件，但是Apple 出于某些原因，6，6plus不开放此功能）</p>
</blockquote>
<ul>
<li>支持后台扫描</li>
</ul>
<blockquote>
<p>但是</p>
<ol>
<li>苹果x之前的设备不支持后台扫描
iPhone X and earlier devices don’t support background tag reading.</li>
<li>Background tag reading doesn't support custom URL schemes. Use universal links instead.后台扫描不支持自定义URL</li>
</ol>
<blockquote>
<p>支持的Scheme</p>
</blockquote>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">URL Scheme</th>
<th style="text-align:center">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Website URL (HTTP/HTTPS</td>
<td style="text-align:center">https://www.example.com</td>
</tr>
<tr>
<td style="text-align:center">Email</td>
<td style="text-align:center">mailto:user@example.com</td>
</tr>
<tr>
<td style="text-align:center">SMS</td>
<td style="text-align:center">sms:+14085551212</td>
</tr>
<tr>
<td style="text-align:center">Telephone</td>
<td style="text-align:center">tel:+14085551212</td>
</tr>
<tr>
<td style="text-align:center">FaceTime</td>
<td style="text-align:center">facetime://user@example.com</td>
</tr>
<tr>
<td style="text-align:center">FaceTime Audio</td>
<td style="text-align:center">facetime-audio://user@example.com</td>
</tr>
<tr>
<td style="text-align:center">Maps</td>
<td style="text-align:center">http://maps.apple.com/?address=Apple%20Park,Cupertino,California</td>
</tr>
<tr>
<td style="text-align:center">HomeKit Accessory Setup</td>
<td style="text-align:center">X-HM://12345</td>
</tr>
<tr>
<td style="text-align:center">For more information on URL schemes</td>
<td style="text-align:center"><a href="https://developer.apple.com/library/archive/featuredarticles/iPhoneURLScheme_Reference/Introduction/Introduction.html#//apple_ref/doc/uid/TP40007899">see Apple URL Scheme Reference</a></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<blockquote>
<blockquote>
<p>支持通用链接Use Universal Links</p>
</blockquote>
</blockquote>
<blockquote>
<ol start="3">
<li>In order to avoid unintentional tag reading, the system reads tags in the background only when the user's iPhone is in use. Also, be aware there are times when the display is on and background tag reading is unavailable, such as if:</li>
</ol>
<blockquote>
<p>为了防止误操作一下5种情况NFC在后台不可用</p>
<ul>
<li>The device has never been unlocked.</li>
<li>A Core NFC reader session is in progress.</li>
<li>Apple Pay Wallet is in use.</li>
<li>The camera is in use.</li>
<li>Airplane mode is enabled.</li>
</ul>
</blockquote>
</blockquote>
<h2 id="%E5%9B%9B-ios-nfc%E5%BC%80%E5%8F%91">四 IOS NFC开发</h2>
<ol>
<li>在info.plist添加权限请求:<code>Privacy - NFC Scan Usage Description</code></li>
<li>在capabilities中开启
<img src="./capability.png" alt="capability"></li>
<li>启动一个NFCNDEFReaderSession,遵循代理</li>
</ol>
<pre class="hljs"><code><div>//Start a Reader Session
_nfcSession = [[NFCNDEFReaderSession alloc] initWithDelegate:self queue:nil invalidateAfterFirstRead:YES];

## 设置提示信息
 _nfcSession.alertMessage = @&quot;请靠近要扫描的物体&quot;;
 //开始扫描           
[_nfcSession beginSession];

## Adopt the Reader Session Delegate Protocol
#pragma mark - NFCNDEFReaderSessionDelegate
- (void)readerSession:(NFCNDEFReaderSession *)session didDetectNDEFs:(NSArray&lt;NFCNDEFMessage *&gt; *)messages{
   ##Read an NDEF Message
}

- (void)readerSession:(NFCNDEFReaderSession *)session didInvalidateWithError:(NSError *)error{
    ## Handle an Invalid Reader Session
//   NFCReaderError

}
</div></code></pre>
<ol start="4">
<li>每个session最多持续60秒，超时将终止</li>
</ol>
<h2 id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</h2>
<p><a href="https://developer.apple.com/design/human-interface-guidelines/ios/user-interaction/near-field-communication/">Human Interface Guidelines</a></p>
<p><a href="https://developer.apple.com/documentation/corenfc?language=objc">Core NFC</a></p>
<p><a href="https://developer.apple.com/videos/play/wwdc2017/718/">WWDC 2017 - Session 718 - iOS</a></p>
<p><a href="https://github.com/393698063/NFCDemo">github Demo</a></p>

</body>
</html>
