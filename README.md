# Near Field Communication

## ä¸€ NFCåŸºæœ¬æ¦‚å¿µä¸ç›¸å…³æœ¯è¯­
*  NFCæ˜¯ä»€ä¹ˆä¸œä¸œï¼Ÿ
>å…¨ç§°Â Near Field Communication ï¼ˆè¿‘åœºé€šè®¯ï¼‰ï¼Œè¿™ä¸ªæŠ€æœ¯ç”±éæ¥è§¦å¼å°„é¢‘è¯†åˆ«ï¼ˆRFIDï¼‰æ¼”å˜è€Œæ¥ï¼Œç”±é£åˆ©æµ¦åŠå¯¼ä½“ï¼ˆç°æ©æ™ºæµ¦åŠå¯¼ä½“å…¬å¸ï¼‰ã€è¯ºåŸºäºšå’Œç´¢å°¼å…±åŒç ”åˆ¶å¼€å‘ï¼Œå…¶åŸºç¡€æ˜¯RFIDåŠäº’è¿æŠ€æœ¯ã€‚è¿‘åœºé€šä¿¡ï¼ˆNear Field Communication,NFCï¼‰æ˜¯ä¸€ç§çŸ­è·é«˜é¢‘çš„æ— çº¿ç”µæŠ€æœ¯ï¼Œåœ¨13.56MHzé¢‘ç‡è¿è¡Œäº10å˜ç±³è·ç¦»å†…
* NFC Tag
> å®ƒæ˜¯å»‰ä»·çš„ã€è¢«åŠ¨å¼çš„RFIDï¼ˆå°„é¢‘è¯†åˆ«ï¼‰Tag,ç²˜è´´æˆ–å†…åµŒå¦‚äº§å“ï¼ŒåŒ…è£¹ï¼Œä¿ƒé”€å“åŠè®¸å¤šå…¶ä»–å®ç‰©ï¼Œç”šè‡³åƒç”µå½±é‡Œä¸€æ ·åµŒå…¥çš®è‚¤ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†RFID Tags æ˜¯ä»€ä¹ˆï¼Ÿ
* RFID Tag
> å®ƒç”±è€¦åˆå…ƒä»¶åŠèŠ¯ç‰‡ç»„æˆï¼Œæ¯ä¸ªRFIDæ ‡ç­¾å…·æœ‰å”¯ä¸€çš„ç”µå­ç¼–ç ï¼ˆå…¨çƒå”¯ä¸€å“¦ğŸ˜¯ï¼‰ï¼Œé™„ç€åœ¨ç‰©ä½“ä¸Šæ ‡è¯†ç›®æ ‡å¯¹è±¡ï¼Œä¿—ç§°ç”µå­æ ‡ç­¾æˆ–æ™ºèƒ½æ ‡ç­¾ã€‚RFIDç”µå­æ ‡ç­¾ï¼šæœ‰æºæ ‡ç­¾ï¼Œæ— æºæ ‡ç­¾ï¼ŒåŠæœ‰æºåŠæ— æºæ ‡ç­¾ã€‚æ™®é€šç”¨çš„åœ°é“å¡å°±æ˜¯æ— æºæ ‡ç­¾ã€‚ ä»€ä¹ˆç¼–ç è¿™ä¹ˆç‰›X, å…¨çƒå”¯ä¸€ï¼Ÿæ˜¯EPCç¼–ç 
* EPCç¼–ç 
> EPCï¼ˆElectronic Product Codeï¼‰å³ç”µå­äº§å“ç¼–ç ï¼Œæ˜¯ä¸€ç§ç¼–ç ç³»ç»Ÿã€‚å®ƒå»ºç«‹åœ¨EAN.UCCï¼ˆå³å…¨çƒç»Ÿä¸€æ ‡è¯†ç³»ç»Ÿï¼‰æ¡å‹ç¼–ç çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¹¶å¯¹è¯¥æ¡å½¢ç¼–ç ç³»ç»Ÿåšäº†ä¸€äº›æ‰©å……ï¼Œç”¨ä»¥å®ç°å¯¹å•å“è¿›è¡Œæ ‡å¿—ã€‚
å®ƒæ˜¯ä¸‹ä¸€ä»£äº§å“æ ‡è¯†ä»£ç ï¼Œå®ƒå¯ä»¥å¯¹ä¾›åº”é“¾ä¸­çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ç‰©å“ã€è´§ç®±ã€è´§ç›˜ã€ä½ç½®ç­‰ï¼‰è¿›è¡Œå…¨çƒå”¯ä¸€çš„æ ‡è¯†ã€‚EPC å­˜å‚¨åœ¨RFIDæ ‡ç­¾ä¸Šï¼Œè¿™ä¸ªæ ‡ç­¾åŒ…å«ä¸€å—ç¡…èŠ¯ç‰‡å’Œä¸€æ ¹å¤©çº¿ã€‚è¯»å– EPCæ ‡ç­¾æ—¶ï¼Œå®ƒå¯ä»¥ä¸ä¸€äº›åŠ¨æ€æ•°æ®è¿æ¥ï¼Œä¾‹å¦‚è¯¥è´¸æ˜“é¡¹ç›®çš„åŸäº§åœ°æˆ–ç”Ÿäº§æ—¥æœŸç­‰ã€‚EPCæ‰€æ ‡è¯†äº§å“çš„ä¿¡æ¯ä¿å­˜åœ¨EPCglobalç½‘ç»œä¸­ï¼Œè€ŒEPCåˆ™æ˜¯è·å–æœ‰å…³è¿™äº›ä¿¡æ¯çš„ä¸€æŠŠé’¥åŒ™
* WWDCè§£é‡Šï¼š
> NFCå®é™…ä¸Šæ˜¯ä¸€ç»„ä¸åŒçš„æ ‡å‡†å’Œåè®®ã€‚æ‰€æœ‰çš„æ ‡å‡†å…±å­˜ï¼Œå¹¶ç”¨äºä¸åŒçš„ç›®çš„ã€‚
NFC textå¯å½’çº³ä¸º5ç±»ï¼Œtype1~type5.æ¯ä¸€ä¸ªç±»å‹å¯¹åº”äºä¸€ä¸ªä¸åŒçš„æ ‡å‡†ã€‚
NFC Forumå®šä¹‰äº†NFC Data Exchange Format(NDEF)ç”¨æ¥ä½œä¸ºä¸åŒçš„NFC textç±»å‹æ•°æ®äº¤æ¢çš„é€šç”¨æ ‡å‡†æ–¹å¼
![NFC TEXT](./5type.png)

## äºŒ ä½¿ç”¨åœºæ™¯
### NFCå·¥ä½œæ¨¡å¼æœ‰ä¸‰ç§ï¼š

1. Reader/Writer modeï¼ˆè¯»å†™å™¨æ¨¡å¼ï¼‰iOSåªæ”¯æŒreaderæ¨¡å¼
>æ­¤æ¨¡å¼å¯ä»¥è¯»å–NFC Tag,ä¹Ÿå¯å†™å…¥Tagæ•°æ®ã€‚ï¼ˆå¯ä»¥æƒ³è±¡æ‰‹æœºç»™åœ°é“å¡å……å€¼ï¼Œå®ƒèƒ½è¯»å–å¡å†…ä¿¡æ¯ï¼Œä¹Ÿèƒ½å†™å…¥æ•°æ®ï¼‰ï¼Œè‹¹æœç»™å‡ºçš„ä½¿ç”¨çš„åœºæ™¯1.è¿æ¥ç”¨æˆ·åˆ°ä½ç½®æˆ–ä¸Šä¸‹æ–‡ç›¸å…³çš„å†…å®¹2.è¿æ¥ç¡¬ä»¶è®¾å¤‡3.ä»“åº“åº“å­˜è¿½è¸ªã€‚

2. Peer-to-Peer mode (ç‚¹å¯¹ç‚¹æ¨¡å¼)Â  iOS ä¸æ”¯æŒ

> å°†ä¸¤ä¸ªå…·å¤‡NFCåŠŸèƒ½çš„è®¾å¤‡é“¾æ¥ï¼Œèƒ½å®ç°æ•°æ®ç‚¹å¯¹ç‚¹ä¼ è¾“ï¼Œå¦‚ä¸‹è½½éŸ³ä¹ã€äº¤æ¢å›¾ç‰‡æˆ–è€…åŒæ­¥è®¾å¤‡åœ°å€è–„ã€‚

3. Card-emulation mode ï¼ˆå¡æ¨¡æ‹Ÿæ¨¡å¼ï¼‰iOSä¸æ”¯æŒ

> å¯ä»¥å°†å…·å¤‡NFCåŠŸèƒ½çš„è®¾å¤‡å½“åšåªèƒ½å¡æˆ–è€…ICå¡ï¼Œæ¯”å¦‚åœ°é“å¡ï¼Œä¿¡ç”¨å¡ï¼Œé—¨ç¦å¡ã€‚

### NFCæ˜¯æ€ä¹ˆæ£€æµ‹åˆ°Tagçš„ï¼Ÿ

> åœ¨NFC Tag(å®ƒæ˜¯ä¸€ç§å»‰ä»·ã€è¢«åŠ¨å¼çš„RFID tag, å°±æ˜¯ä¸€ä¸ªé›†æˆç”µè·¯)ä¸­æœ‰å¤©çº¿ä¸ç”µè·¯ã€‚å½“æ‹¿å…·å¤‡NFCåŠŸèƒ½çš„æ‰‹æœºæˆ–å…¶ä»–è¯»å–å™¨é è¿‘æ—¶ï¼Œæ‰‹æœºæˆ–è¯»å–å™¨å‘å°„é«˜é¢‘ç”µç£æ³¢ï¼ˆå°„é¢‘ä¿¡å·ï¼‰ï¼Œå¼•å‘Tagå†…çš„ç”µè·¯äº§ç”Ÿæ„Ÿåº”ç”µæµï¼ˆå¡å†…æ²¡æœ‰ç”µæºï¼Œå…¨é è¯»å–å™¨å‘å°„çš„ç”µç£æ³¢äº§ç”Ÿç”µæµé©±åŠ¨ï¼‰ï¼ŒTagåˆ©ç”¨äº§ç”Ÿçš„ç”µæµå‘å°„å‡ºTagå†…å­˜å‚¨æ˜¯æ•°æ®

## ä¸‰ iOS å¯¹NFCæ”¯æŒçš„ç°çŠ¶

 2017å¹´ï¼ŒWWDCæ­£å¼å‘å¸ƒäº†iOS11,åœ¨SDKä¸­é¦–æ¬¡å¼€æ”¾äº†NFCåŠŸèƒ½,å¼€å‘è€…å¯é€šè¿‡Core NFC FrameWork ä½¿ç”¨NFCåŠŸèƒ½ã€‚æ­¤æ¬¡å‘å¸ƒçš„ç‰ˆæœ¬æ”¯æŒçš„åŠŸèƒ½éå¸¸ä¿å®ˆï¼Œåªæ”¯æŒ NFC Tag Reading åŠŸèƒ½ 
 * æ”¯æŒæœºå‹ï¼š
 > iPhone 7 åŠåç»­å‘å¸ƒæœºå‹ï¼ˆè™½ç„¶iPhone 6å¼€å§‹å·²ç»æœ‰NFCç¡¬ä»¶ï¼Œä½†æ˜¯Apple å‡ºäºæŸäº›åŸå› ï¼Œ6ï¼Œ6plusä¸å¼€æ”¾æ­¤åŠŸèƒ½ï¼‰
 * æ”¯æŒåå°æ‰«æ
 > ä½†æ˜¯
 > 1. è‹¹æœxä¹‹å‰çš„è®¾å¤‡ä¸æ”¯æŒåå°æ‰«æ
 iPhone X and earlier devices donâ€™t support background tag reading.
 > 2. Background tag reading doesn't support custom URL schemes. Use universal links instead.åå°æ‰«æä¸æ”¯æŒè‡ªå®šä¹‰URL  
>> æ”¯æŒçš„Scheme

| URL Scheme | Example |
|:-----:|:-----:|
| Website URL (HTTP/HTTPS | https://www.example.com | 
| Email | mailto:user@example.com | 
| SMS | sms:+14085551212| 
| Telephone | tel:+14085551212 | 
| FaceTime | facetime://user@example.com | 
| FaceTime Audio | facetime-audio://user@example.com | 
| Maps | http://maps.apple.com/?address=Apple%20Park,Cupertino,California | 
| HomeKit Accessory Setup | X-HM://12345 | 
| For more information on URL schemes | [see Apple URL Scheme Reference](https://developer.apple.com/library/archive/featuredarticles/iPhoneURLScheme_Reference/Introduction/Introduction.html#//apple_ref/doc/uid/TP40007899) |
| | |

>> æ”¯æŒé€šç”¨é“¾æ¥Use Universal Links 

 > 3. In order to avoid unintentional tag reading, the system reads tags in the background only when the user's iPhone is in use. Also, be aware there are times when the display is on and background tag reading is unavailable, such as if:
    >> ä¸ºäº†é˜²æ­¢è¯¯æ“ä½œä¸€ä¸‹5ç§æƒ…å†µNFCåœ¨åå°ä¸å¯ç”¨
    >> *  The device has never been unlocked.
    >> * A Core NFC reader session is in progress.
    >> * Apple Pay Wallet is in use.
    >> * The camera is in use.
    >> * Airplane mode is enabled.

## å›› IOS NFCå¼€å‘
1. åœ¨info.plistæ·»åŠ æƒé™è¯·æ±‚:`Privacy - NFC Scan Usage Description`
2. åœ¨capabilitiesä¸­å¼€å¯
![capability](./capability.png)
3. å¯åŠ¨ä¸€ä¸ªNFCNDEFReaderSession,éµå¾ªä»£ç†
```
//Start a Reader Session
_nfcSession = [[NFCNDEFReaderSession alloc] initWithDelegate:self queue:nil invalidateAfterFirstRead:YES];

## è®¾ç½®æç¤ºä¿¡æ¯
 _nfcSession.alertMessage = @"è¯·é è¿‘è¦æ‰«æçš„ç‰©ä½“";
 //å¼€å§‹æ‰«æ           
[_nfcSession beginSession];

## Adopt the Reader Session Delegate Protocol
#pragma mark - NFCNDEFReaderSessionDelegate
- (void)readerSession:(NFCNDEFReaderSession *)session didDetectNDEFs:(NSArray<NFCNDEFMessage *> *)messages{
   ##Read an NDEF Message
}

- (void)readerSession:(NFCNDEFReaderSession *)session didInvalidateWithError:(NSError *)error{
    ## Handle an Invalid Reader Session
//   NFCReaderError

}
```

4. æ¯ä¸ªsessionæœ€å¤šæŒç»­60ç§’ï¼Œè¶…æ—¶å°†ç»ˆæ­¢


## å‚è€ƒèµ„æ–™
[Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines/ios/user-interaction/near-field-communication/)

[Core NFC](https://developer.apple.com/documentation/corenfc?language=objc)

[WWDC 2017 - Session 718 - iOS](https://developer.apple.com/videos/play/wwdc2017/718/)

[github Demo](https://github.com/393698063/NFCDemo)